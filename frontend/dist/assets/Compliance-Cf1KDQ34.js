import{r as g,j as e}from"./index-I8dvfz4x.js";import{u as M}from"./useData-D9HvdgoV.js";import{R as I,S as O}from"./server-BAOvSIsI.js";import{T as y,S as R,E as P,C as $,Z as B}from"./zap-D8OujFWH.js";import{C as U,E as G}from"./external-link-CmTK8780.js";import"./createLucideIcon-CbKX9OMZ.js";const V=(h,d)=>{const w=m=>m.replace(/^v/,"").split(".").map(u=>parseInt(u,10)||0),j=w(h),b=w(d);for(let m=0;m<Math.max(j.length,b.length);m++){const u=j[m]||0,v=b[m]||0;if(u>v)return 1;if(u<v)return-1}return 0};function J(){const{state:h}=M(!0),[d,w]=g.useState(null),[j,b]=g.useState(!0),[m,u]=g.useState(null),[v,D]=g.useState(null),[A,L]=g.useState(!0),T=g.useMemo(()=>()=>{if(!h.apis||h.apis.length===0)return{services:{},violations:[],totalViolations:0,criticalViolations:0,warningViolations:0,compliantServices:0,totalServices:0,complianceScore:100,timestamp:new Date().toISOString()};const t=h.apis.reduce((c,l)=>{var s;const o=l.name||"unknown";return c[o]||(c[o]={}),c[o][l.environment||"unknown"]={service:o,version:l.version||"0.0.0",url:l.url,status:l.status||"unknown",environment:l.environment||"unknown",region:l.region||"unknown",responseTime:l.responseTime,projectId:l.projectId,projectName:((s=h.projects.find(r=>r.id===l.projectId))==null?void 0:s.name)||"Unknown"},c},{}),n=[];let x=0;Object.entries(t).forEach(([c,l])=>{const o=l.dev||l.development,s=l.uat||l.staging,r=l.oat,a=l.prod||l.production;let N=!1;const f=[];a!=null&&a.version&&(s!=null&&s.version)&&V(a.version,s.version)>0&&(f.push({service:c,projectName:a.projectName||"Unknown",violation:`CRITICAL: PROD version (${a.version}) is higher than UAT version (${s.version})`,severity:"critical",environments:{dev:o==null?void 0:o.version,uat:s==null?void 0:s.version,oat:r==null?void 0:r.version,prod:a==null?void 0:a.version}}),N=!0),a!=null&&a.version&&(r!=null&&r.version)&&V(a.version,r.version)>0&&(f.push({service:c,projectName:a.projectName||"Unknown",violation:`CRITICAL: PROD version (${a.version}) is higher than OAT version (${r.version})`,severity:"critical",environments:{dev:o==null?void 0:o.version,uat:s==null?void 0:s.version,oat:r==null?void 0:r.version,prod:a==null?void 0:a.version}}),N=!0),r!=null&&r.version&&(s!=null&&s.version)&&V(r.version,s.version)>0&&(f.push({service:c,projectName:r.projectName||s.projectName||"Unknown",violation:`WARNING: OAT version (${r.version}) is higher than UAT version (${s.version})`,severity:"warning",environments:{dev:o==null?void 0:o.version,uat:s==null?void 0:s.version,oat:r==null?void 0:r.version,prod:a==null?void 0:a.version}}),N=!0),a&&!s&&(f.push({service:c,projectName:a.projectName||"Unknown",violation:`WARNING: PROD exists (${a.version}) but UAT environment is missing`,severity:"warning",environments:{dev:o==null?void 0:o.version,uat:s==null?void 0:s.version,oat:r==null?void 0:r.version,prod:a==null?void 0:a.version}}),N=!0),n.push(...f),N&&x++});const i=Object.keys(t).length,p=i-x,S=i>0?Math.round(p/i*100):100;return{services:t,violations:n,totalViolations:n.length,criticalViolations:n.filter(c=>c.severity==="critical").length,warningViolations:n.filter(c=>c.severity==="warning").length,compliantServices:p,totalServices:i,complianceScore:S,timestamp:new Date().toISOString()}},[h.apis,h.projects]),C=async()=>{b(!0),u(null);try{const t=T();w(t),D(new Date)}catch(t){console.error("Compliance check failed:",t),u("Failed to check compliance. Please try again.")}finally{b(!1)}};g.useEffect(()=>{C()},[T]),g.useEffect(()=>{if(!A)return;const t=setInterval(()=>{C()},3e4);return()=>clearInterval(t)},[A,T]);const k=({icon:t,title:n,value:x,color:i,description:p})=>e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:n}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x}),p&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p})]})]})}),E=t=>{switch(t.toLowerCase()){case"dev":case"development":return"bg-green-100 text-green-800";case"uat":case"staging":return"bg-yellow-100 text-yellow-800";case"oat":return"bg-orange-100 text-orange-800";case"prod":case"production":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return j&&!d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"w-8 h-8 text-red-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Checking compliance..."})]})}):m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-8 h-8 text-red-600 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})}):d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl shadow-lg",children:e.jsx(R,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600",children:"Version compliance validation across environments"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:t=>L(t.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{children:"Auto-refresh"})]})}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:["Updated: ",v==null?void 0:v.toLocaleTimeString()]})]}),e.jsxs("button",{onClick:C,disabled:j,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-lg hover:from-red-700 hover:to-orange-700 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50",children:[e.jsx(I,{className:`w-4 h-4 ${j?"animate-spin":""}`}),e.jsx("span",{children:"Check Compliance"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(k,{icon:O,title:"Total Services",value:d.totalServices,color:"bg-gradient-to-r from-blue-500 to-blue-600"}),e.jsx(k,{icon:y,title:"Total Violations",value:d.totalViolations,color:"bg-gradient-to-r from-red-500 to-red-600"}),e.jsx(k,{icon:U,title:"Critical Issues",value:d.criticalViolations,color:"bg-gradient-to-r from-orange-500 to-orange-600"}),e.jsx(k,{icon:R,title:"Compliance Score",value:`${d.complianceScore}%`,color:"bg-gradient-to-r from-red-500 to-red-600",description:"Services without violations"})]}),d.violations.length>0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(y,{className:"w-5 h-5 text-red-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Compliance Violations (",d.violations.length,")"]})]}),e.jsx("div",{className:"space-y-4",children:d.violations.map((t,n)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${t.severity==="critical"?"bg-red-50 border-red-500":t.severity==="warning"?"bg-yellow-50 border-yellow-500":"bg-blue-50 border-blue-500"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.severity==="critical"?e.jsx(U,{className:"w-5 h-5 text-red-600"}):e.jsx(y,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:t.service}),e.jsxs("span",{className:"text-sm text-gray-600",children:["in ",t.projectName]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.severity==="critical"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.severity.toUpperCase()})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:t.violation}),e.jsx("div",{className:"flex items-center space-x-2",children:Object.entries(t.environments).map(([x,i])=>i?e.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${E(x)}`,children:[x.toUpperCase(),": v",i]},x):null)})]})})},n))})]}):e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-8 shadow-lg border border-white/20 text-center",children:[e.jsx($,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"All Systems Compliant"}),e.jsx("p",{className:"text-gray-600",children:"No version compliance violations detected across all environments."})]}),Object.keys(d.services).length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Environment Version Matrix"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Real-time version comparison across all environments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Service"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Project"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"DEV"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"UAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"OAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"PROD"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Response Time"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:Object.entries(d.services).map(([t,n])=>{var p,S,c,l,o,s;const x=d.violations.some(r=>r.service===t),i=Object.values(n)[0];return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${x?"bg-red-50":""}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t}),x&&e.jsx(y,{className:"w-4 h-4 text-red-500"})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:(i==null?void 0:i.projectName)||"Unknown"}),e.jsx("td",{className:"py-3 px-4 text-center",children:n.dev||n.development?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:["v",((p=n.dev)==null?void 0:p.version)||((S=n.development)==null?void 0:S.version)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:n.uat||n.staging?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:["v",((c=n.uat)==null?void 0:c.version)||((l=n.staging)==null?void 0:l.version)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:n.oat?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-800",children:["v",n.oat.version]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:n.prod||n.production?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:["v",((o=n.prod)==null?void 0:o.version)||((s=n.production)==null?void 0:s.version)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${(i==null?void 0:i.status)==="online"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx($,{className:"w-3 h-3 mr-1"}),(i==null?void 0:i.status)||"unknown"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(B,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(i==null?void 0:i.responseTime)||0,"ms"]})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})})})]},t)})})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No compliance data available"})]})})}export{J as default};
