import{r as g,j as e}from"./index-C9k2OWly.js";import{u as E}from"./useData-BHYmVQS5.js";import{R,S as $}from"./server-Bge-Hfnk.js";import{T as y,S as O,E as M,C as V,Z as B}from"./zap-DGhGODY6.js";import{C as U,E as G}from"./external-link-MRbTDQJ3.js";import"./createLucideIcon-D5700ZAF.js";const w=(h,x)=>{const C=m=>m.replace(/^v/,"").split(".").map(v=>parseInt(v,10)||0),N=C(h),f=C(x);for(let m=0;m<Math.max(N.length,f.length);m++){const v=N[m]||0,b=f[m]||0;if(v>b)return 1;if(v<b)return-1}return 0};function J(){const{state:h}=E(!0),[x,C]=g.useState(null),[N,f]=g.useState(!0),[m,v]=g.useState(null),[b,D]=g.useState(null),[T,L]=g.useState(!0),I=g.useMemo(()=>()=>{if(!h.apis||h.apis.length===0)return{services:{},violations:[],totalViolations:0,criticalViolations:0,warningViolations:0,compliantServices:0,totalServices:0,complianceScore:0,timestamp:new Date().toISOString()};const n=h.apis.reduce((c,l)=>{var t;const i=l.name||"unknown";return c[i]||(c[i]={}),c[i][l.environment||"unknown"]={service:i,version:l.version||"0.0.0",url:l.url,status:l.status||"unknown",environment:l.environment||"unknown",region:l.region||"unknown",responseTime:l.responseTime,projectId:l.projectId,projectName:((t=h.projects.find(r=>r.id===l.projectId))==null?void 0:t.name)||"Unknown"},c},{}),a=[];let d=0;Object.entries(n).forEach(([c,l])=>{const i=l.dev||l.development,t=l.uat||l.staging,r=l.oat,s=l.prod||l.production;let j=!1;const u=[];s!=null&&s.version&&(t!=null&&t.version)&&w(s.version,t.version)>0&&(u.push({service:c,projectName:s.projectName||"Unknown",violation:`CRITICAL: PROD version (${s.version}) is higher than UAT version (${t.version})`,severity:"critical",environments:{dev:i==null?void 0:i.version,uat:t==null?void 0:t.version,oat:r==null?void 0:r.version,prod:s==null?void 0:s.version}}),j=!0),s!=null&&s.version&&(r!=null&&r.version)&&w(s.version,r.version)>0&&(u.push({service:c,projectName:s.projectName||"Unknown",violation:`CRITICAL: PROD version (${s.version}) is higher than OAT version (${r.version})`,severity:"critical",environments:{dev:i==null?void 0:i.version,uat:t==null?void 0:t.version,oat:r==null?void 0:r.version,prod:s==null?void 0:s.version}}),j=!0),r!=null&&r.version&&(t!=null&&t.version)&&w(r.version,t.version)>0&&(u.push({service:c,projectName:r.projectName||t.projectName||"Unknown",violation:`WARNING: OAT version (${r.version}) is higher than UAT version (${t.version})`,severity:"warning",environments:{dev:i==null?void 0:i.version,uat:t==null?void 0:t.version,oat:r==null?void 0:r.version,prod:s==null?void 0:s.version}}),j=!0),r!=null&&r.version&&(s!=null&&s.version)&&w(r.version,s.version)>0&&(u.push({service:c,projectName:r.projectName||s.projectName||"Unknown",violation:`CRITICAL: OAT version (${r.version}) is higher than PROD version (${s.version})`,severity:"critical",environments:{dev:i==null?void 0:i.version,uat:t==null?void 0:t.version,oat:r==null?void 0:r.version,prod:s==null?void 0:s.version}}),j=!0),t!=null&&t.version&&(s!=null&&s.version)&&w(t.version,s.version)>0&&(u.push({service:c,projectName:t.projectName||s.projectName||"Unknown",violation:`CRITICAL: UAT version (${t.version}) is higher than PROD version (${s.version})`,severity:"critical",environments:{dev:i==null?void 0:i.version,uat:t==null?void 0:t.version,oat:r==null?void 0:r.version,prod:s==null?void 0:s.version}}),j=!0),s&&!t&&(u.push({service:c,projectName:s.projectName||"Unknown",violation:`WARNING: PROD exists (${s.version}) but UAT environment is missing`,severity:"warning",environments:{dev:i==null?void 0:i.version,uat:t==null?void 0:t.version,oat:r==null?void 0:r.version,prod:s==null?void 0:s.version}}),j=!0),a.push(...u),j&&d++});const o=Object.keys(n).length,p=o-d,A=o>0?Math.round(p/o*100):0;return{services:n,violations:a,totalViolations:a.length,criticalViolations:a.filter(c=>c.severity==="critical").length,warningViolations:a.filter(c=>c.severity==="warning").length,compliantServices:p,totalServices:o,complianceScore:A,timestamp:new Date().toISOString()}},[h.apis,h.projects]),k=async()=>{f(!0),v(null);try{const n=I();C(n),D(new Date)}catch(n){console.error("Compliance check failed:",n),v("Failed to check compliance. Please try again.")}finally{f(!1)}};g.useEffect(()=>{k()},[I]),g.useEffect(()=>{if(!T)return;const n=setInterval(()=>{k()},3e4);return()=>clearInterval(n)},[T,I]);const S=({icon:n,title:a,value:d,color:o,description:p})=>e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${o}`,children:e.jsx(n,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:a}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d}),p&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p})]})]})}),P=n=>{switch(n.toLowerCase()){case"dev":case"development":return"bg-green-100 text-green-800";case"uat":case"staging":return"bg-yellow-100 text-yellow-800";case"oat":return"bg-orange-100 text-orange-800";case"prod":case"production":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return N&&!x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"w-8 h-8 text-red-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Checking compliance..."})]})}):m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-8 h-8 text-red-600 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})}):x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl shadow-lg",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600",children:"Version compliance validation across environments"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:n=>L(n.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{children:"Auto-refresh"})]})}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsxs("span",{children:["Updated: ",b==null?void 0:b.toLocaleTimeString()]})]}),e.jsxs("button",{onClick:k,disabled:N,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-lg hover:from-red-700 hover:to-orange-700 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50",children:[e.jsx(R,{className:`w-4 h-4 ${N?"animate-spin":""}`}),e.jsx("span",{children:"Check Compliance"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(S,{icon:$,title:"Total Services",value:x.totalServices,color:"bg-gradient-to-r from-blue-500 to-blue-600"}),e.jsx(S,{icon:y,title:"Total Violations",value:x.totalViolations,color:"bg-gradient-to-r from-red-500 to-red-600"}),e.jsx(S,{icon:U,title:"Critical Issues",value:x.criticalViolations,color:"bg-gradient-to-r from-orange-500 to-orange-600"}),e.jsx(S,{icon:O,title:"Compliance Score",value:`${x.complianceScore}%`,color:"bg-gradient-to-r from-red-500 to-red-600",description:"Services without violations"})]}),x.violations.length>0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx(y,{className:"w-5 h-5 text-red-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Compliance Violations (",x.violations.length,")"]})]}),e.jsx("div",{className:"space-y-4",children:x.violations.map((n,a)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${n.severity==="critical"?"bg-red-50 border-red-500":n.severity==="warning"?"bg-yellow-50 border-yellow-500":"bg-blue-50 border-blue-500"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.severity==="critical"?e.jsx(U,{className:"w-5 h-5 text-red-600"}):e.jsx(y,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:n.service}),e.jsxs("span",{className:"text-sm text-gray-600",children:["in ",n.projectName]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${n.severity==="critical"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:n.severity.toUpperCase()})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:n.violation}),e.jsx("div",{className:"flex items-center space-x-2",children:Object.entries(n.environments).map(([d,o])=>o?e.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${P(d)}`,children:[d.toUpperCase(),": v",o]},d):null)})]})})},a))})]}):e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-8 shadow-lg border border-white/20 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"All Systems Compliant"}),e.jsx("p",{className:"text-gray-600",children:"No version compliance violations detected across all environments."})]}),Object.keys(x.services).length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Environment Version Matrix"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Real-time version comparison across all environments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Service"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Project"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"DEV"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"UAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"OAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"PROD"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Response Time"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:Object.entries(x.services).map(([n,a])=>{var p,A,c,l,i,t;const d=x.violations.some(r=>r.service===n),o=Object.values(a)[0];return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${d?"bg-red-50":""}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n}),d&&e.jsx(y,{className:"w-4 h-4 text-red-500"})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:(o==null?void 0:o.projectName)||"Unknown"}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.dev||a.development?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:["v",((p=a.dev)==null?void 0:p.version)||((A=a.development)==null?void 0:A.version)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.uat||a.staging?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:["v",((c=a.uat)==null?void 0:c.version)||((l=a.staging)==null?void 0:l.version)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.oat?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-800",children:["v",a.oat.version]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.prod||a.production?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:["v",((i=a.prod)==null?void 0:i.version)||((t=a.production)==null?void 0:t.version)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${(o==null?void 0:o.status)==="online"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),(o==null?void 0:o.status)||"unknown"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(B,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(o==null?void 0:o.responseTime)||0,"ms"]})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})})})]},n)})})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No compliance data available"})]})})}export{J as default};
